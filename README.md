# ДЗ №4 для открытой школы Java-разработчиков от T1
**Суть задания:** Создание базового веб-приложения с использованием Spring Security и JWT для аутентификации и авторизации пользователей.
# Описание реализации:
В приложении реализована проверка и генерация токенов JWT и сконфигурирована проверка доступа пользователя к ресурсам на основе токенов. Для пользователя доступно две роли: **USER**, **ADMIN**.

Данные о пользователе и токены сохраняются в базу данных. Схема модели данных:

![image](https://github.com/devkabezrooki/t1-security/assets/49373926/c01d6a93-2ee4-4330-addc-69115776e47d)

Для управления сущностями в бд используется liquibase. Для создания таблиц написан скрипт (src\main\resources\db\changelog\liquibase.xml), также в этом скрипте в базу добавляется администратор (username и пароль "admin", роли USER и ADMIN)

## REST API

Реализован REST-контроллер **SecurityController** для регистрации/авторизации пользователей. Написаны следующие методы:

* POST /security/register - Регистрация нового пользователя:
  - Принимает в теле запроса дто RegisterRequest  (обязательное) с информацией о пользователе.
  - Если входные данные корректны создает пользователя, генерирует для него JWT токен, сохраняет пользователя и токен в базу, возвращает токен и статус 200.
  - Если входные данные некорректны или пользователь с таким юзернеймом/почтой уже существует возвращает ошибку и статус 500.
* POST /security/login - Авторизация пользователя:
  - Принимает в теле запроса дто LoginRequest  (обязательное) с логином + паролем пользователя.
  - Если входные данные корректны выполняется проверка наличия токена для пользователя в базе, если токена нет/он просрочен, то создается и сохраняется токен пользователя.
  - В случае успешной работы возвращает актуальный токен пользователя и статус 200.
  - Если входные данные некорректны возвращает ошибку и статус 500.

Схема дто **RegisterRequest**:

![image](https://github.com/devkabezrooki/t1-security/assets/49373926/e720bd1a-98dd-4a1f-a620-bad1598c3764)

Схема дто **LoginRequest**:

![image](https://github.com/devkabezrooki/t1-security/assets/49373926/c4ef0b6f-4e73-4b98-980e-50122b5c3b4a)

Для методов контроллера SecurityController не проверяются права доступа.

Для проверки прав доступа пользователей реализован контроллер **AccessCheckingController**. Содержит два метода:

* GET /check/admin - Точка доступа для админа:
  - В заголовке запроса необходимо передать актуальный токен пользователя с правами админа.
  - Если передан корректный токен возвращает текст "Доступно админам", иначе - статус 403.
* GET /check/all - Точка доступа для всех пользователей:
  - В заголовке необходимо передать актуальный токен любого пользователя.
  - Если передан корректный токен возвращает текст "Доступно всем", иначе - статус 403.

Для взаимодействия с контроллерами добавлен Swagger, доступен по адресу /swagger-ui/index.html.

# Запуск приложения
Можно запустить приложение вместе с бд с помощью докера. Для этого необходимо:

1. Клонировать репозиторий с проектом
2. Из корневой папки проекта в командной строке выполнить команду для развертывания проекта
   ```
   docker-compose up
   ```
3. Приложение запускается на порте 8090.
# Использованные технологии:
* Java 17
* Spring Boot
* Spring Data Jpa
* Spring Security
* JWT
* Junit
* Mockito
* Postgresql
* Liquibase
* Swagger
* Docker
